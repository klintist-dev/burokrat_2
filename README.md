# –ë—é—Ä–æ–∫—Ä–∞—Ç–™ 2.0 ‚Äî –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤

> üìö **–î–ª—è –∫–æ–≥–æ —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç**: –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø–µ—Ä–≤–æ–≥–æ –∫—É—Ä—Å–∞, –∫–æ—Ç–æ—Ä—ã–µ —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞—é—Ç –∏–∑—É—á–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ö–æ—Ç—è—Ç –ø–æ–Ω—è—Ç—å, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Telegram-–±–æ—Ç.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–í–≤–µ–¥–µ–Ω–∏–µ: —á—Ç–æ —Ç–∞–∫–æ–µ Telegram-–±–æ—Ç?](#1-–≤–≤–µ–¥–µ–Ω–∏–µ-—á—Ç–æ-—Ç–∞–∫–æ–µ-telegram-–±–æ—Ç)
2. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#2-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
3. [–§–∞–π–ª `config_reader.py` ‚Äî —Å–µ–∫—Ä–µ—Ç—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏](#3-—Ñ–∞–π–ª-config_readerpy--—Å–µ–∫—Ä–µ—Ç—ã-–∏-–Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
4. [–§–∞–π–ª `keyboards.py` ‚Äî –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è](#4-—Ñ–∞–π–ª-keyboardspy--–∫–Ω–æ–ø–∫–∏-–¥–ª—è-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
5. [–ü–∞–ø–∫–∞ `handlers/` ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥](#5-–ø–∞–ø–∫–∞-handlers--–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏-–∫–æ–º–∞–Ω–¥)
6. [–§–∞–π–ª `start.py` ‚Äî –∫–æ–º–∞–Ω–¥–∞ /start](#6-—Ñ–∞–π–ª-startpy--–∫–æ–º–∞–Ω–¥–∞-start)
7. [–§–∞–π–ª `buttons.py` ‚Äî –ª–æ–≥–∏–∫–∞ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫](#7-—Ñ–∞–π–ª-buttonspy--–ª–æ–≥–∏–∫–∞-–≤—Å–µ—Ö-–∫–Ω–æ–ø–æ–∫)
8. [–ü–∞–ø–∫–∞ `parsers/` ‚Äî –ø–∞—Ä—Å–∏–Ω–≥ —Å–∞–π—Ç–æ–≤](#8-–ø–∞–ø–∫–∞-parsers--–ø–∞—Ä—Å–∏–Ω–≥-—Å–∞–π—Ç–æ–≤)
9. [–§–∞–π–ª `nalog_parser.py` ‚Äî —Ä–∞–±–æ—Ç–∞ —Å —Å–∞–π—Ç–æ–º –§–ù–° (—Å–∞–º–æ–µ —Å–ª–æ–∂–Ω–æ–µ!)](#9-—Ñ–∞–π–ª-nalog_parserpy--—Ä–∞–±–æ—Ç–∞-—Å-—Å–∞–π—Ç–æ–º-—Ñ–Ω—Å-—Å–∞–º–æ–µ-—Å–ª–æ–∂–Ω–æ–µ)
10. [–ü–∞–ø–∫–∞ `services/` ‚Äî –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã](#10-–ø–∞–ø–∫–∞-services--–≤–Ω–µ—à–Ω–∏–µ-—Å–µ—Ä–≤–∏—Å—ã)
11. [–§–∞–π–ª `gigachat.py` ‚Äî —Ä–∞–±–æ—Ç–∞ —Å GigaChat](#11-—Ñ–∞–π–ª-gigachatpy--—Ä–∞–±–æ—Ç–∞-—Å-gigachat)
12. [Git: –∫–∞–∫ –º—ã —Å–æ—Ö—Ä–∞–Ω—è–ª–∏ –∫–æ–¥](#12-git-–∫–∞–∫-–º—ã-—Å–æ—Ö—Ä–∞–Ω—è–ª–∏-–∫–æ–¥)
13. [Railway: –∫–∞–∫ –±–æ—Ç –ø–æ–ø–∞–ª –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç](#13-railway-–∫–∞–∫-–±–æ—Ç-–ø–æ–ø–∞–ª-–≤-–∏–Ω—Ç–µ—Ä–Ω–µ—Ç)
14. [–°–ª–æ–≤–∞—Ä—å —Ç–µ—Ä–º–∏–Ω–æ–≤ –¥–ª—è –Ω–æ–≤–∏—á–∫–∞](#14-—Å–ª–æ–≤–∞—Ä—å-—Ç–µ—Ä–º–∏–Ω–æ–≤-–¥–ª—è-–Ω–æ–≤–∏—á–∫–∞)

---

## 1. –í–≤–µ–¥–µ–Ω–∏–µ: —á—Ç–æ —Ç–∞–∫–æ–µ Telegram-–±–æ—Ç?

### ü§î –ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏

Telegram-–±–æ—Ç ‚Äî —ç—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–∞, –∫–æ—Ç–æ—Ä–∞—è –∂–∏–≤—ë—Ç –Ω–µ –Ω–∞ —Ç–≤–æ—ë–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ, –∞ –≥–¥–µ-—Ç–æ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ (–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ). –¢—ã –ø–∏—à–µ—à—å –µ–π —Å–æ–æ–±—â–µ–Ω–∏—è, –∞ –æ–Ω–∞ –æ—Ç–≤–µ—á–∞–µ—Ç.

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –¢—ã –Ω–∞–∂–∏–º–∞–µ—à—å –∫–Ω–æ–ø–∫—É –≤ –±–æ—Ç–µ ‚Üí Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–∏–≥–Ω–∞–ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä, –≥–¥–µ –∂–∏–≤—ë—Ç –±–æ—Ç
2. –°–µ—Ä–≤–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–≤–æ—ë —Å–æ–æ–±—â–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏—â–µ—Ç –ò–ù–ù –Ω–∞ —Å–∞–π—Ç–µ –§–ù–°)
3. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ Telegram

### üß† –ê–Ω–∞–ª–æ–≥–∏—è –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è

–ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ –±–æ—Ç ‚Äî —ç—Ç–æ —Ç–≤–æ–π –¥—Ä—É–≥, –∫–æ—Ç–æ—Ä—ã–π —Å–∏–¥–∏—Ç –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ:
- –¢—ã –ø–∏—à–µ—à—å –µ–º—É: "–ù–∞–π–¥–∏ –∫–Ω–∏–≥—É –ø—Ä–æ –ì–∞—Ä—Ä–∏ –ü–æ—Ç—Ç–µ—Ä–∞" (—ç—Ç–æ —Ç–≤–æ–π –∑–∞–ø—Ä–æ—Å)
- –î—Ä—É–≥ –∏–¥—ë—Ç –ø–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ, –∏—â–µ—Ç –∫–Ω–∏–≥—É (—ç—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∫–∞)
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∏ –≥–æ–≤–æ—Ä–∏—Ç: "–í–æ—Ç –æ–Ω–∞, –Ω–∞ 3-–π –ø–æ–ª–∫–µ" (—ç—Ç–æ –æ—Ç–≤–µ—Ç)

### ‚ö° –ü–æ—á–µ–º—É –±–æ—Ç –Ω–µ –∑–∞–≤–∏—Å–∞–µ—Ç (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å)

–í –∫–æ–¥–µ —Ç—ã —á–∞—Å—Ç–æ –≤–∏–¥–∏—à—å —Å–ª–æ–≤–æ `async` (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ). –≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –±–æ—Ç –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–µ–ª –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

–ü—Ä–∏–º–µ—Ä:
- –ü–æ–∫–∞ –±–æ—Ç –∂–¥—ë—Ç –æ—Ç–≤–µ—Ç –æ—Ç —Å–∞–π—Ç–∞ –§–ù–° (—ç—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 10-20 —Å–µ–∫—É–Ω–¥)
- –û–Ω —É–∂–µ –æ—Ç–≤–µ—á–∞–µ—Ç –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- –ö–∞–∫ —Ç–æ–ª—å–∫–æ –æ—Ç–≤–µ—Ç –ø—Ä–∏—à—ë–ª ‚Äî –±–æ—Ç —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ –ø–µ—Ä–≤–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

–ë–µ–∑ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏ –±–æ—Ç –∑–∞–≤–∏—Å–∞–ª –±—ã –Ω–∞ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –∏ –Ω–µ –º–æ–≥ –±—ã –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–µ–ª–æ–≤–µ–∫ —Å—Ä–∞–∑—É.

---

## 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–í–æ—Ç –∫–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω—ã —Ñ–∞–π–ª—ã –≤ —Ç–≤–æ—ë–º –ø—Ä–æ–µ–∫—Ç–µ:
burokrat_2/ # –ö–æ—Ä–Ω–µ–≤–∞—è –ø–∞–ø–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
‚îÇ
‚îú‚îÄ‚îÄ .env # –°–ï–ö–†–ï–¢–ù–û! –¢–æ–∫–µ–Ω—ã –±–æ—Ç–∞ (–Ω–µ –≤ git!)
‚îú‚îÄ‚îÄ .env.example # –ü—Ä–∏–º–µ—Ä, –∫–∞–∫ –¥–æ–ª–∂–µ–Ω –≤—ã–≥–ª—è–¥–µ—Ç—å .env
‚îú‚îÄ‚îÄ .gitignore # –ö–∞–∫–∏–µ —Ñ–∞–π–ª—ã –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤ GitHub
‚îú‚îÄ‚îÄ requirements.txt # –°–ø–∏—Å–æ–∫ –±–∏–±–ª–∏–æ—Ç–µ–∫, –Ω—É–∂–Ω—ã—Ö –±–æ—Ç—É
‚îú‚îÄ‚îÄ Procfile # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è Railway, –∫–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å
‚îú‚îÄ‚îÄ runtime.txt # –ö–∞–∫–∞—è –≤–µ—Ä—Å–∏—è Python –Ω—É–∂–Ω–∞
‚îÇ
‚îî‚îÄ‚îÄ bot/ # –û—Å–Ω–æ–≤–Ω–∞—è –ø–∞–ø–∫–∞ —Å –∫–æ–¥–æ–º –±–æ—Ç–∞
‚îÇ
‚îú‚îÄ‚îÄ init.py # –ü—É—Å—Ç–æ–π —Ñ–∞–π–ª, –≥–æ–≤–æ—Ä–∏—Ç Python: "—ç—Ç–æ –ø–∞–ø–∫–∞ —Å –∫–æ–¥–æ–º"
‚îú‚îÄ‚îÄ main.py # –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ (—Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞)
‚îú‚îÄ‚îÄ config_reader.py # –ß–∏—Ç–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã –∏–∑ .env
‚îú‚îÄ‚îÄ keyboards.py # –ö–Ω–æ–ø–∫–∏ –¥–ª—è Telegram
‚îÇ
‚îú‚îÄ‚îÄ handlers/ # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
‚îÇ ‚îú‚îÄ‚îÄ init.py
‚îÇ ‚îú‚îÄ‚îÄ start.py # –ö–æ–º–∞–Ω–¥–∞ /start
‚îÇ ‚îî‚îÄ‚îÄ buttons.py # –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
‚îÇ
‚îú‚îÄ‚îÄ parsers/ # –ü–∞—Ä—Å–µ—Ä—ã (–¥–æ—Å—Ç–∞—é—Ç –¥–∞–Ω–Ω—ã–µ —Å —Å–∞–π—Ç–æ–≤)
‚îÇ ‚îú‚îÄ‚îÄ init.py
‚îÇ ‚îî‚îÄ‚îÄ nalog_parser.py # –†–∞–±–æ—Ç–∞ —Å —Å–∞–π—Ç–æ–º –§–ù–° (–ï–ì–†–Æ–õ)
‚îÇ
‚îî‚îÄ‚îÄ services/ # –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã
‚îú‚îÄ‚îÄ init.py
‚îî‚îÄ‚îÄ gigachat.py # –†–∞–±–æ—Ç–∞ —Å GigaChat


### üîç –ß—Ç–æ –æ–∑–Ω–∞—á–∞—é—Ç –ø–∞–ø–∫–∏:

| –ü–∞–ø–∫–∞ | –ß—Ç–æ —Ç–∞–º –ª–µ–∂–∏—Ç | –ó–∞—á–µ–º |
|-------|---------------|-------|
| `handlers/` | –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ | –†–µ–∞–≥–∏—Ä—É—é—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| `parsers/` | –ü–∞—Ä—Å–µ—Ä—ã | "–ü–∞—Ä—Å—è—Ç" (—Ä–∞–∑–±–∏—Ä–∞—é—Ç) —Å–∞–π—Ç—ã, —á—Ç–æ–±—ã –¥–æ—Å—Ç–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é |
| `services/` | –°–µ—Ä–≤–∏—Å—ã | –†–∞–±–æ—Ç–∞ —Å –≤–Ω–µ—à–Ω–∏–º–∏ API (GigaChat) |

---

## 3. –§–∞–π–ª `config_reader.py` ‚Äî —Å–µ–∫—Ä–µ—Ç—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–≠—Ç–æ—Ç —Ñ–∞–π–ª –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —á—Ç–µ–Ω–∏–µ **—Ç–æ–∫–µ–Ω–æ–≤** –∏ **–Ω–∞—Å—Ç—Ä–æ–µ–∫** –∏–∑ —Ñ–∞–π–ª–∞ `.env`. –ü–æ—á–µ–º—É –Ω–µ–ª—å–∑—è –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—Å–∞—Ç—å —Ç–æ–∫–µ–Ω –≤ –∫–æ–¥–µ? –ü–æ—Ç–æ–º—É —á—Ç–æ —Ç–æ–≥–¥–∞ –ª—é–±–æ–π, –∫—Ç–æ —É–≤–∏–¥–∏—Ç –∫–æ–¥, —Å–º–æ–∂–µ—Ç —É–∫—Ä–∞—Å—Ç—å —Ç–≤–æ–µ–≥–æ –±–æ—Ç–∞!

### üìù –ö–æ–¥ —Å –ø–æ—è—Å–Ω–µ–Ω–∏—è–º–∏

```python
# ‚¨áÔ∏è Pydantic ‚Äî –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏. SecretStr ‚Äî —Ç–∏–ø "—Å–µ–∫—Ä–µ—Ç–Ω–∞—è —Å—Ç—Ä–æ–∫–∞"
from pydantic import SecretStr

# ‚¨áÔ∏è BaseSettings ‚Äî —á–∏—Ç–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ .env –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
from pydantic_settings import BaseSettings

# ‚¨áÔ∏è lru_cache ‚Äî –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ñ—É–Ω–∫—Ü–∏–∏, —á—Ç–æ–±—ã –Ω–µ —á–∏—Ç–∞—Ç—å .env –∫–∞–∂–¥—ã–π —Ä–∞–∑
from functools import lru_cache

class BotConfig(BaseSettings):
    """
    –ö–ª–∞—Å—Å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –±–æ—Ç–∞.
    –ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è –æ–±—ä–µ–∫—Ç —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å–∞, –æ–Ω —Å–∞–º —á–∏—Ç–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .env
    """
    
    token: SecretStr  
    # ‚¨ÜÔ∏è –¢–æ–∫–µ–Ω –±–æ—Ç–∞ (—Å–µ–∫—Ä–µ—Ç!). SecretStr –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –ø—Ä–∏ –ø–µ—á–∞—Ç–∏ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å '********'
    
    admin_id: int  
    # ‚¨ÜÔ∏è –¢–≤–æ–π Telegram ID (—á—Ç–æ–±—ã –±–æ—Ç –∑–Ω–∞–ª –∞–¥–º–∏–Ω–∞). –ù—É–∂–µ–Ω –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    
    bot_name: str = "–ë—é—Ä–æ–∫—Ä–∞—Ç–™ 2.0"  
    # ‚¨ÜÔ∏è –ò–º—è –±–æ—Ç–∞ (–º–æ–∂–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å). –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ –≤ .env, –±—É–¥–µ—Ç "–ë—é—Ä–æ–∫—Ä–∞—Ç–™ 2.0"
    
    debug: bool = False  
    # ‚¨ÜÔ∏è –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏. –ï—Å–ª–∏ True ‚Äî –±—É–¥–µ—Ç –ø–µ—á–∞—Ç–∞—Ç—å –±–æ–ª—å—à–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
    
    gigachat_api_key: SecretStr  
    # ‚¨ÜÔ∏è –ö–ª—é—á –¥–ª—è GigaChat (—Ç–æ–∂–µ —Å–µ–∫—Ä–µ—Ç!)

    class Config:
        """
        –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–ª–∞—Å—Å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —Å–∞–º–æ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞
        """
        env_file = ".env"  
        # ‚¨ÜÔ∏è –ì–¥–µ –ª–µ–∂–∞—Ç —Å–µ–∫—Ä–µ—Ç—ã (–≤ —Ñ–∞–π–ª–µ .env –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞)
        
        env_prefix = "BOT_"  
        # ‚¨ÜÔ∏è –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å BOT_. 
        # –ó–Ω–∞—á–∏—Ç –≤ .env –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å BOT_TOKEN, BOT_ADMIN_ID –∏ —Ç.–¥.
        
        env_file_encoding = "utf-8"  
        # ‚¨ÜÔ∏è –ö–æ–¥–∏—Ä–æ–≤–∫–∞ —Ñ–∞–π–ª–∞ (—á—Ç–æ–±—ã —Ä—É—Å—Å–∫–∏–µ –±—É–∫–≤—ã —á–∏—Ç–∞–ª–∏—Å—å)


@lru_cache  # ‚¨ÖÔ∏è –î–µ–∫–æ—Ä–∞—Ç–æ—Ä. –ó–∞–ø–æ–º–∏–Ω–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –≤—ã–∑–æ–≤–∞
def get_config() -> BotConfig:
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥ (–æ–±—ä–µ–∫—Ç —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏).
    lru_cache –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ 1 —Ä–∞–∑,
    –∞ –ø–æ—Ç–æ–º –±—É–¥–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
    –≠—Ç–æ —ç–∫–æ–Ω–æ–º–∏—Ç –≤—Ä–µ–º—è –∏ —Ä–µ—Å—É—Ä—Å—ã.
    """
    return BotConfig()  
    # ‚¨ÜÔ∏è –°–æ–∑–¥–∞—ë–º –æ–±—ä–µ–∫—Ç –∫–ª–∞—Å—Å–∞ BotConfig. 
    # –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–Ω —Å–∞–º –ø—Ä–æ—á–∏—Ç–∞–µ—Ç .env –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç –ø–æ–ª—è

üß† –ß—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:

    class BotConfig(BaseSettings): ‚Äî –º—ã —Å–æ–∑–¥–∞—ë–º "–∫–æ—Ä–æ–±–∫—É" —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏. –í —ç—Ç–æ–π –∫–æ—Ä–æ–±–∫–µ –±—É–¥—É—Ç –ª–µ–∂–∞—Ç—å: —Ç–æ–∫–µ–Ω, admin_id, –∫–ª—é—á GigaChat –∏ —Ç.–¥.

    token: SecretStr ‚Äî –≥–æ–≤–æ—Ä–∏–º: "–≤ –∫–æ—Ä–æ–±–∫–µ –µ—Å—Ç—å –æ—Ç–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è —Ç–æ–∫–µ–Ω–∞, –∏ –æ–Ω–æ —Å–µ–∫—Ä–µ—Ç–Ω–æ–µ"

    env_prefix = "BOT_" ‚Äî –≥–æ–≤–æ—Ä–∏–º: "–∫–æ–≥–¥–∞ –±—É–¥–µ—à—å —á–∏—Ç–∞—Ç—å .env, –∏—â–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å BOT_"

    @lru_cache ‚Äî "–∑–∞–ø–æ–º–Ω–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç, —á—Ç–æ–±—ã –Ω–µ —á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª –∫–∞–∂–¥—ã–π —Ä–∞–∑"

üîê –ü–æ—á–µ–º—É —Ç–æ–∫–µ–Ω—ã –Ω–µ–ª—å–∑—è —Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫–æ–¥–µ?

–ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ —Ç—ã –Ω–∞–ø–∏—Å–∞–ª —Ç–æ–∫–µ–Ω –ø—Ä—è–º–æ –≤ –∫–æ–¥–µ –∏ –≤—ã–ª–æ–∂–∏–ª –Ω–∞ GitHub. –õ—é–±–æ–π –º–æ–∂–µ—Ç:

    –ù–∞–π—Ç–∏ —Ç–≤–æ–µ–≥–æ –±–æ—Ç–∞

    –£–∑–Ω–∞—Ç—å —Ç–æ–∫–µ–Ω

    –£–≥–Ω–∞—Ç—å –±–æ—Ç–∞ (–º–µ–Ω—è—Ç—å –∫–æ–º–∞–Ω–¥—ã, –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–ø–∞–º)

–ü–æ—ç—Ç–æ–º—É –º—ã —Ö—Ä–∞–Ω–∏–º —Ç–æ–∫–µ–Ω—ã –≤ .env, –∞ —Å–∞–º .env ‚Äî –≤ .gitignore (—á—Ç–æ–±—ã –Ω–µ –ø–æ–ø–∞–¥–∞–ª –≤ git).

4. –§–∞–π–ª keyboards.py ‚Äî –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–∑–¥–∞—ë—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É ‚Äî —Ç–µ —Å–∞–º—ã–µ –∫–Ω–æ–ø–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤–∏–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞.
üìù –ö–æ–¥ —Å –ø–æ—è—Å–Ω–µ–Ω–∏—è–º–∏

# ‚¨áÔ∏è –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ç–∏–ø—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ aiogram
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton

# ‚¨áÔ∏è –°–æ–∑–¥–∞—ë–º –∫–∞–∂–¥—É—é –∫–Ω–æ–ø–∫—É –æ—Ç–¥–µ–ª—å–Ω–æ
# KeyboardButton ‚Äî —ç—Ç–æ –æ–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞
# –í —Å–∫–æ–±–∫–∞—Ö –ø–∏—à–µ–º —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –Ω–∞ –∫–Ω–æ–ø–∫–µ
button_inn = KeyboardButton(text="üîç –ü–æ–∏—Å–∫ –ò–ù–ù")
# ‚¨ÜÔ∏è –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ò–ù–ù –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

button_extract = KeyboardButton(text="üìÑ –í—ã–ø–∏—Å–∫–∞ –ï–ì–†–Æ–õ")
# ‚¨ÜÔ∏è –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—ã–ø–∏—Å–∫–∏ –∏–∑ —Ä–µ–µ—Å—Ç—Ä–∞

button_ask = KeyboardButton(text="üí¨ –í–æ–ø—Ä–æ—Å")
# ‚¨ÜÔ∏è –ö–Ω–æ–ø–∫–∞ –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∫ GigaChat

button_doc = KeyboardButton(text="‚úçÔ∏è –î–æ–∫—É–º–µ–Ω—Ç")
# ‚¨ÜÔ∏è –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

button_help = KeyboardButton(text="‚ùì –ü–æ–º–æ—â—å")
# ‚¨ÜÔ∏è –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏

# ‚¨áÔ∏è –¢–µ–ø–µ—Ä—å —Å–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏ –≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
# ReplyKeyboardMarkup ‚Äî —ç—Ç–æ —Ü–µ–ª–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
# keyboard=[] ‚Äî —Å–ø–∏—Å–æ–∫ —Ä—è–¥–æ–≤ —Å –∫–Ω–æ–ø–∫–∞–º–∏
main_keyboard = ReplyKeyboardMarkup(
    keyboard=[
        [button_inn],          # ‚¨ÖÔ∏è –ü–µ—Ä–≤—ã–π —Ä—è–¥: —Ç–æ–ª—å–∫–æ –∫–Ω–æ–ø–∫–∞ –ü–æ–∏—Å–∫ –ò–ù–ù
        [button_extract],      # ‚¨ÖÔ∏è –í—Ç–æ—Ä–æ–π —Ä—è–¥: —Ç–æ–ª—å–∫–æ –í—ã–ø–∏—Å–∫–∞
        [button_ask],          # ‚¨ÖÔ∏è –¢—Ä–µ—Ç–∏–π —Ä—è–¥: —Ç–æ–ª—å–∫–æ –í–æ–ø—Ä–æ—Å
        [button_doc],          # ‚¨ÖÔ∏è –ß–µ—Ç–≤—ë—Ä—Ç—ã–π —Ä—è–¥: —Ç–æ–ª—å–∫–æ –î–æ–∫—É–º–µ–Ω—Ç
        [button_help]          # ‚¨ÖÔ∏è –ü—è—Ç—ã–π —Ä—è–¥: —Ç–æ–ª—å–∫–æ –ü–æ–º–æ—â—å
    ],
    resize_keyboard=True,      
    # ‚¨ÜÔ∏è –£–º–µ–Ω—å—à–∏—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –ø–æ–¥ —Ä–∞–∑–º–µ—Ä —ç–∫—Ä–∞–Ω–∞ (—á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –æ–≥—Ä–æ–º–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫)
    
    input_field_placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ..."
    # ‚¨ÜÔ∏è –¢–µ–∫—Å—Ç-–ø–æ–¥—Å–∫–∞–∑–∫–∞ –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ (–ø–æ–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–ø–∏—Å–∞–ª)
)
üß† –ß—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:

    KeyboardButton ‚Äî —ç—Ç–æ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–∞—è –∫–ª–∞–≤–∏—à–∞ –Ω–∞ –ø—É–ª—å—Ç–µ

    ReplyKeyboardMarkup ‚Äî —ç—Ç–æ –≤–µ—Å—å –ø—É–ª—å—Ç —Ü–µ–ª–∏–∫–æ–º (–∫—É–¥–∞ –º—ã –∫—Ä–µ–ø–∏–º –∫–Ω–æ–ø–∫–∏)

    keyboard=[ [–∫–Ω–æ–ø–∫–∞1], [–∫–Ω–æ–ø–∫–∞2] ] ‚Äî –∫–∞–∂–¥—ã–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Å–ø–∏—Å–æ–∫ [ ] ‚Äî —ç—Ç–æ –æ–¥–∏–Ω —Ä—è–¥ –∫–Ω–æ–ø–æ–∫

üì± –ö–∞–∫ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

_____________________________
| üîç –ü–æ–∏—Å–∫ –ò–ù–ù              |
| üìÑ –í—ã–ø–∏—Å–∫–∞ –ï–ì–†–Æ–õ          |
| üí¨ –í–æ–ø—Ä–æ—Å                 |
| ‚úçÔ∏è –î–æ–∫—É–º–µ–Ω—Ç               |
| ‚ùì –ü–æ–º–æ—â—å                  |
-----------------------------

üé® –ü–æ—á–µ–º—É –º—ã —Å–¥–µ–ª–∞–ª–∏ –∫–Ω–æ–ø–∫–∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ?

–ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —Ç–µ–ª–µ—Ñ–æ–Ω–∞—Ö —à–∏—Ä–æ–∫–∏–µ –∫–Ω–æ–ø–∫–∏ –≤ 2 —Ä—è–¥–∞ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ—É–¥–æ–±–Ω—ã ‚Äî –ø–∞–ª—å—Ü–µ–º —Ç—Ä—É–¥–Ω–æ –ø–æ–ø–∞—Å—Ç—å. –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ (–æ–¥–Ω–∞ –ø–æ–¥ –¥—Ä—É–≥–æ–π) —É–¥–æ–±–Ω–µ–µ –¥–ª—è —Ç—ã–∫–∞–Ω—å—è –ø–∞–ª—å—Ü–µ–º.
5. –ü–∞–ø–∫–∞ handlers/ ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥

–í —ç—Ç–æ–π –ø–∞–ø–∫–µ –∂–∏–≤—É—Ç —Ñ–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–≥–∏—Ä—É—é—Ç –Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
–§–∞–π–ª handlers/__init__.py

–≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–≤—è–∑—ã–≤–∞–µ—Ç –≤—Å–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤–æ–µ–¥–∏–Ω–æ.

# ‚¨áÔ∏è –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω—É–∂–Ω—ã–µ –∫–ª–∞—Å—Å—ã –∏–∑ aiogram
from aiogram import Router, F
from aiogram.filters import Command

# ‚¨áÔ∏è –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞—à–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑ –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–æ–≤
from .start import cmd_start                     # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ /start
from .buttons import (
    handle_inn_by_name,      # –ü–æ–∏—Å–∫ –ò–ù–ù
    handle_extract_by_inn,   # –í—ã–ø–∏—Å–∫–∞
    handle_ask,              # –í–æ–ø—Ä–æ—Å GigaChat
    handle_doc,              # –°–æ—Å—Ç–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç
    handle_help,             # –ü–æ–º–æ—â—å
    handle_user_input        # –õ—é–±–æ–π –¥—Ä—É–≥–æ–π —Ç–µ–∫—Å—Ç
)

# ‚¨áÔ∏è –°–æ–∑–¥–∞—ë–º "—Ä–æ—É—Ç–µ—Ä" ‚Äî –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
# –∫ –Ω—É–∂–Ω—ã–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º
router = Router()

# ‚¨áÔ∏è –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–æ–º–∞–Ω–¥—ã /start
# –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç /start ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è cmd_start
router.message.register(cmd_start, Command("start"))

# ‚¨áÔ∏è –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
# F.text == "—Ç–µ–∫—Å—Ç" ‚Äî –∑–Ω–∞—á–∏—Ç, —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, –µ—Å–ª–∏ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∫–Ω–æ–ø–∫–æ–π
router.message.register(handle_inn_by_name, F.text == "üîç –ü–æ–∏—Å–∫ –ò–ù–ù")
router.message.register(handle_extract_by_inn, F.text == "üìÑ –í—ã–ø–∏—Å–∫–∞ –ï–ì–†–Æ–õ")
router.message.register(handle_ask, F.text == "üí¨ –í–æ–ø—Ä–æ—Å")
router.message.register(handle_doc, F.text == "‚úçÔ∏è –î–æ–∫—É–º–µ–Ω—Ç")
router.message.register(handle_help, F.text == "‚ùì –ü–æ–º–æ—â—å")

# ‚¨áÔ∏è –°–∞–º—ã–π –ø–æ—Å–ª–µ–¥–Ω–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ ‚Äî –¥–ª—è –ª—é–±–æ–≥–æ –¥—Ä—É–≥–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
# (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–º, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã —Ä–∞–Ω—å—à–µ)
router.message.register(handle_user_input)

print("üü¢ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã!")
# ‚¨ÜÔ∏è –ü—Ä–æ—Å—Ç–æ —á—Ç–æ–±—ã –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—ã–ª–æ –≤–∏–¥–Ω–æ, —á—Ç–æ –≤—Å—ë –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å

üß† –ß—Ç–æ —Ç–∞–∫–æ–µ —Ä–æ—É—Ç–µ—Ä?

–ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ –±–æ—Ç ‚Äî —ç—Ç–æ –±–æ–ª—å—à–æ–π –æ—Ñ–∏—Å, –∞ —Ä–æ—É—Ç–µ—Ä ‚Äî —ç—Ç–æ —Å–µ–∫—Ä–µ—Ç–∞—Ä—å –Ω–∞ —Ä–µ—Å–µ–ø—à–µ–Ω–µ:

    –ü—Ä–∏—Ö–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ "üîç –ü–æ–∏—Å–∫ –ò–ù–ù" ‚Üí —Å–µ–∫—Ä–µ—Ç–∞—Ä—å –≥–æ–≤–æ—Ä–∏—Ç: "–≠—Ç–æ –∫ –ò–≤–∞–Ω—É –∏–∑ –æ—Ç–¥–µ–ª–∞ –ø–æ–∏—Å–∫–∞" (handle_inn_by_name)

    –ü—Ä–∏—Ö–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ "–ø—Ä–∏–≤–µ—Ç" (–±–µ–∑ –∫–Ω–æ–ø–∫–∏) ‚Üí —Å–µ–∫—Ä–µ—Ç–∞—Ä—å –≥–æ–≤–æ—Ä–∏—Ç: "–Ø –Ω–µ –∑–Ω–∞—é —Ç–∞–∫–æ–≥–æ, —ç—Ç–æ –∫ —Å—Ç–∞–∂—ë—Ä—É" (handle_user_input)

–ü–æ—á–µ–º—É handle_user_input –ø–æ—Å–ª–µ–¥–Ω–∏–π?

–ü–æ—Ç–æ–º—É —á—Ç–æ –µ—Å–ª–∏ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –µ–≥–æ –ø–µ—Ä–≤—ã–º, –æ–Ω –±—É–¥–µ—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –≤–∫–ª—é—á–∞—è –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫–∏. –ù–∞–º –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–ª–∏—Å—å –∫–Ω–æ–ø–∫–∏, –∞ –ø–æ—Ç–æ–º —É–∂–µ –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ.
6. –§–∞–π–ª start.py ‚Äî –∫–æ–º–∞–Ω–¥–∞ /start

–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Ñ–∞–π–ª ‚Äî –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

from aiogram.types import Message
from aiogram.utils.formatting import Text, Bold
from bot.keyboards import main_keyboard  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞—à—É –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É

async def cmd_start(message: Message):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
    message: –æ–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç, id –∏ —Ç.–¥.)
    """
    
    # ‚¨áÔ∏è –ë–µ—Ä—ë–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—á—Ç–æ–±—ã –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –ª–∏—á–Ω–æ)
    user_name = message.from_user.first_name
    
    # ‚¨áÔ∏è –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç (Bold ‚Äî –∂–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç)
    content = Text(
        Bold(f"–ü—Ä–∏–≤–µ—Ç, {user_name}!"), "\n\n",
        "–Ø –ë—é—Ä–æ–∫—Ä–∞—Ç–™ 2.0 ‚Äî —Ç–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫ –≤ —Ä–∞–±–æ—Ç–µ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏.\n\n",
        "–Ø —É–º–µ—é:\n",
        "üîç –ù–∞—Ö–æ–¥–∏—Ç—å –ò–ù–ù –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏\n",
        "üìÑ –î–∞–≤–∞—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤—ã–ø–∏—Å–∫–∏ –∏–∑ –ï–ì–†–Æ–õ\n",
        "üí¨ –û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ GigaChat\n",
        "‚úçÔ∏è –°–æ—Å—Ç–∞–≤–ª—è—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã\n\n",
        "–í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ –Ω–∏–∂–µ üëá"
    )
    
    # ‚¨áÔ∏è –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    # **content.as_kwargs() ‚Äî –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –≤ –∞—Ä–≥—É–º–µ–Ω—Ç—ã
    # reply_markup=main_keyboard ‚Äî –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ–º –Ω–∞—à—É –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
    await message.answer(**content.as_kwargs(), reply_markup=main_keyboard)

from aiogram.types import Message
from aiogram.utils.formatting import Text, Bold
from bot.keyboards import main_keyboard  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞—à—É –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É

async def cmd_start(message: Message):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
    message: –æ–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç, id –∏ —Ç.–¥.)
    """
    
    # ‚¨áÔ∏è –ë–µ—Ä—ë–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—á—Ç–æ–±—ã –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –ª–∏—á–Ω–æ)
    user_name = message.from_user.first_name
    
    # ‚¨áÔ∏è –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç (Bold ‚Äî –∂–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç)
    content = Text(
        Bold(f"–ü—Ä–∏–≤–µ—Ç, {user_name}!"), "\n\n",
        "–Ø –ë—é—Ä–æ–∫—Ä–∞—Ç–™ 2.0 ‚Äî —Ç–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫ –≤ —Ä–∞–±–æ—Ç–µ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏.\n\n",
        "–Ø —É–º–µ—é:\n",
        "üîç –ù–∞—Ö–æ–¥–∏—Ç—å –ò–ù–ù –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏\n",
        "üìÑ –î–∞–≤–∞—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤—ã–ø–∏—Å–∫–∏ –∏–∑ –ï–ì–†–Æ–õ\n",
        "üí¨ –û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ GigaChat\n",
        "‚úçÔ∏è –°–æ—Å—Ç–∞–≤–ª—è—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã\n\n",
        "–í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ –Ω–∏–∂–µ üëá"
    )
    
    # ‚¨áÔ∏è –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    # **content.as_kwargs() ‚Äî –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –≤ –∞—Ä–≥—É–º–µ–Ω—Ç—ã
    # reply_markup=main_keyboard ‚Äî –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ–º –Ω–∞—à—É –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
    await message.answer(**content.as_kwargs(), reply_markup=main_keyboard)

üß† –ß—Ç–æ –∑–¥–µ—Å—å –≤–∞–∂–Ω–æ:

    message.from_user.first_name ‚Äî —Ç–∞–∫ –±–æ—Ç —É–∑–Ω–∞—ë—Ç –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

    Text –∏ Bold ‚Äî –¥–µ–ª–∞—é—Ç —Ç–µ–∫—Å—Ç –∫—Ä–∞—Å–∏–≤—ã–º (–∂–∏—Ä–Ω—ã–º)

    reply_markup=main_keyboard ‚Äî –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ—Ç –∫–Ω–æ–ø–∫–∏ –∫ —Å–æ–æ–±—â–µ–Ω–∏—é

7. –§–∞–π–ª buttons.py ‚Äî –ª–æ–≥–∏–∫–∞ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ (—Å–∞–º—ã–π –±–æ–ª—å—à–æ–π!)

–≠—Ç–æ—Ç —Ñ–∞–π–ª –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è, –∫—Ä–æ–º–µ /start.
–•—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π

# ‚¨áÔ∏è –°–ª–æ–≤–∞—Ä–∏ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
# user_search_type[user_id] = "ask"  ‚Äî –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–µ–π—á–∞—Å –≤ —Ä–µ–∂–∏–º–µ "–≤–æ–ø—Ä–æ—Å"
user_search_type = {}

# user_search_data[user_id] = {"company_name": "–†–æ–º–∞—à–∫–∞"}  ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–∞
user_search_data = {}

–ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ? –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –ø–æ–º–Ω–∏—Ç—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–µ–π—á–∞—Å –¥–µ–ª–∞–µ—Ç. –ï—Å–ª–∏ –æ–Ω –Ω–∞–∂–∞–ª "–ü–æ–∏—Å–∫ –ò–ù–ù", –º—ã –ø–µ—Ä–µ–≤–æ–¥–∏–º –µ–≥–æ –≤ —Ä–µ–∂–∏–º name_step1 –∏ –∂–¥—ë–º, –ø–æ–∫–∞ –æ–Ω –≤–≤–µ–¥—ë—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ.
–û–±—Ä–∞–±–æ—Ç—á–∏–∫ "–ü–æ–∏—Å–∫ –ò–ù–ù"

async def handle_inn_by_name(message: Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ 'üîç –ù–∞–π—Ç–∏ –ò–ù–ù –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é'"""
    user_id = message.from_user.id
    # ‚¨áÔ∏è –ü–µ—Ä–µ–≤–æ–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ä–µ–∂–∏–º "–ø–æ–∏—Å–∫, —à–∞–≥ 1"
    user_search_type[user_id] = "name_step1"

    content = FText(
        Bold("üîç –ü–æ–∏—Å–∫ –ò–ù–ù –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é"), "\n\n",
        "–í–≤–µ–¥–∏—Ç–µ **–Ω–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏**:\n\n",
        Italic("–ù–∞–ø—Ä–∏–º–µ—Ä: –û–û–û –†–æ–º–∞—à–∫–∞, –ò–ü –ò–≤–∞–Ω–æ–≤, –Ø–Ω–¥–µ–∫—Å")
    )
    await message.answer(**content.as_kwargs())

async def handle_inn_by_name(message: Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ 'üîç –ù–∞–π—Ç–∏ –ò–ù–ù –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é'"""
    user_id = message.from_user.id
    # ‚¨áÔ∏è –ü–µ—Ä–µ–≤–æ–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ä–µ–∂–∏–º "–ø–æ–∏—Å–∫, —à–∞–≥ 1"
    user_search_type[user_id] = "name_step1"

    content = FText(
        Bold("üîç –ü–æ–∏—Å–∫ –ò–ù–ù –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é"), "\n\n",
        "–í–≤–µ–¥–∏—Ç–µ **–Ω–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏**:\n\n",
        Italic("–ù–∞–ø—Ä–∏–º–µ—Ä: –û–û–û –†–æ–º–∞—à–∫–∞, –ò–ü –ò–≤–∞–Ω–æ–≤, –Ø–Ω–¥–µ–∫—Å")
    )
    await message.answer(**content.as_kwargs())

–û–±—Ä–∞–±–æ—Ç—á–∏–∫ "–í—ã–ø–∏—Å–∫–∞ –ï–ì–†–Æ–õ"

async def handle_extract_by_inn(message: Message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ 'üìÑ –í—ã–ø–∏—Å–∫–∞ –∏–∑ –ï–ì–†–Æ–õ'"""
    user_id = message.from_user.id
    # ‚¨áÔ∏è –ü–µ—Ä–µ–≤–æ–¥–∏–º –≤ —Ä–µ–∂–∏–º "–≤—ã–ø–∏—Å–∫–∞"
    user_search_type[user_id] = "extract"

    await message.answer(
        "üìÑ <b>–ü–æ–ª—É—á–µ–Ω–∏–µ –≤—ã–ø–∏—Å–∫–∏ –∏–∑ –ï–ì–†–Æ–õ</b>\n\n"
        "–í–≤–µ–¥–∏—Ç–µ <b>–ò–ù–ù –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏</b>, –∏ —è –ø—Ä–∏—à–ª—é –≤—ã–ø–∏—Å–∫—É "
        '<a href="https://egrul.nalog.ru">—Å —Å–∞–π—Ç–∞ –§–ù–°</a>.\n\n'
        "<i>–ù–∞–ø—Ä–∏–º–µ—Ä: 4707013298</i>",
        parse_mode="HTML"  # ‚¨ÖÔ∏è –†–∞–∑—Ä–µ—à–∞–µ–º HTML-—Ç–µ–≥–∏ –≤ —Ç–µ–∫—Å—Ç–µ
    )

–°–∞–º—ã–π –≤–∞–∂–Ω—ã–π ‚Äî handle_user_input

–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ª—é–±–æ–π —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤–≤–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.

async def handle_user_input(message: Message):
    """
    –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ª—é–±–æ–π —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤–≤–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    """
    user_id = message.from_user.id
    text = message.text.strip()

    # ‚¨áÔ∏è –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–∂–∞–ª –Ω–∏ –æ–¥–Ω–æ–π –∫–Ω–æ–ø–∫–∏ ‚Äî –ø—Ä–æ—Å–∏–º –≤—ã–±—Ä–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ
    if user_id not in user_search_type:
        await message.answer(
            "–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ.",
            reply_markup=main_keyboard
        )
        return

    search_type = user_search_type[user_id]

    ###########################################################################
    # –ü–û–ò–°–ö –ò–ù–ù –ü–û –ù–ê–ó–í–ê–ù–ò–Æ (2 –®–ê–ì–ê)
    ###########################################################################
    
    if search_type == "name_step1":
        # ‚¨áÔ∏è –®–∞–≥ 1: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤—ë–ª –Ω–∞–∑–≤–∞–Ω–∏–µ
        user_search_data[user_id] = {"company_name": text}
        user_search_type[user_id] = "name_step2"
        
        await message.answer(
            "üìç <b>–£–∫–∞–∂–∏—Ç–µ –∫–æ–¥ —Ä–µ–≥–∏–æ–Ω–∞</b>\n\n"
            "–í–≤–µ–¥–∏—Ç–µ <b>–∫–æ–¥ —Ä–µ–≥–∏–æ–Ω–∞</b> (2 —Ü–∏—Ñ—Ä—ã):\n\n"
            "<i>–ù–∞–ø—Ä–∏–º–µ—Ä: 47 –¥–ª—è –õ–µ–Ω–æ–±–ª–∞—Å—Ç–∏\n"
            "77 –¥–ª—è –ú–æ—Å–∫–≤—ã\n"
            "78 –¥–ª—è –ü–∏—Ç–µ—Ä–∞</i>\n\n"
            "<i>–ò–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ ¬´-¬ª, –µ—Å–ª–∏ —Ä–µ–≥–∏–æ–Ω –Ω–µ –≤–∞–∂–µ–Ω</i>",
            parse_mode="HTML"
        )

    elif search_type == "name_step2":
        # ‚¨áÔ∏è –®–∞–≥ 2: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤—ë–ª —Ä–µ–≥–∏–æ–Ω
        saved_data = user_search_data.get(user_id, {})
        company_name = saved_data.get("company_name", "")
        
        # ‚¨áÔ∏è –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∏—Å–∫–∞—Ç—å –ø–æ —Ä–µ–≥–∏–æ–Ω—É –∏–ª–∏ –ø–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏
        region_code = text if text not in ['-', '–ª—é–±–æ–π', '–ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å', '–Ω–µ—Ç'] else None
        
        # ‚¨áÔ∏è –ü–æ–∫–∞–∑—ã–≤–∞–µ–º "–±–æ—Ç –ø–µ—á–∞—Ç–∞–µ—Ç"
        wait_msg = await message.answer(f"üîç –ò—â—É –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é '{company_name}'...")
        
        # ‚¨áÔ∏è –í—ã–∑—ã–≤–∞–µ–º –ø–∞—Ä—Å–µ—Ä (–æ–Ω –µ—Å—Ç—å –≤ –¥—Ä—É–≥–æ–º —Ñ–∞–π–ª–µ)
        if region_code:
            result = await find_inn_by_name_with_region(company_name, region_code)
        else:
            result = await find_inn_by_name(company_name)
        
        # ‚¨áÔ∏è –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ "–ø–µ—á–∞—Ç–∞–µ—Ç"
        await wait_msg.delete()
        
        # ‚¨áÔ∏è –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        await message.answer(result, parse_mode=None, reply_markup=main_keyboard)
        
        # ‚¨áÔ∏è –£–¥–∞–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—à–µ–ª –∏–∑ —Ä–µ–∂–∏–º–∞)
        del user_search_type[user_id]
        if user_id in user_search_data:
            del user_search_data[user_id]

–û–±—Ä–∞–±–æ—Ç—á–∏–∫ "–í–æ–ø—Ä–æ—Å" (—Å –∏—Å—Ç–æ—Ä–∏–µ–π!)

elif search_type == "ask":
        # ‚¨áÔ∏è –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —Ö–æ—á–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–π—Ç–∏
        if text.lower() in ["–≤—ã—Ö–æ–¥", "exit", "—Å—Ç–æ–ø", "stop", "–º–µ–Ω—é", "menu"]:
            del user_search_type[user_id]
            await message.answer(
                "‚úÖ –í—ã –≤—ã—à–ª–∏ –∏–∑ —Ä–µ–∂–∏–º–∞ –≤–æ–ø—Ä–æ—Å–æ–≤.",
                reply_markup=main_keyboard
            )
            return
            
        wait_msg = await message.answer("ü§î GigaChat –¥—É–º–∞–µ—Ç –Ω–∞–¥ –æ—Ç–≤–µ—Ç–æ–º...")
        
        # ‚¨áÔ∏è –í–ê–ñ–ù–û: –ø–µ—Ä–µ–¥–∞—ë–º user_id, —á—Ç–æ–±—ã GigaChat –∑–Ω–∞–ª, —á—å—é –∏—Å—Ç–æ—Ä–∏—é –±—Ä–∞—Ç—å
        result = await gigachat_inn.ask_question(user_id, text)
        
        await wait_msg.delete()
        await message.answer(result, parse_mode=None, reply_markup=main_keyboard)
        # ‚¨áÔ∏è –ù–ï —É–¥–∞–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –∑–∞–¥–∞–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å–æ–≤!
        # del user_search_type[user_id]  ‚Äî –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ

–û–±—Ä–∞–±–æ—Ç—á–∏–∫ "–í—ã–ø–∏—Å–∫–∞" (–ø–æ—Å–ª–µ –Ω–∞—à–∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π!)

    elif search_type == "extract":
        # ‚¨áÔ∏è –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤–≤–µ–ª–∏ 10 –∏–ª–∏ 12 —Ü–∏—Ñ—Ä
        if not text.isdigit() or len(text) not in (10, 12):
            await message.answer(
                "‚ùå –ò–ù–ù –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 10 –∏–ª–∏ 12 —Ü–∏—Ñ—Ä.\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑:",
                reply_markup=main_keyboard
            )
            return

        wait_msg = await message.answer(
            "üìÑ <b>–ó–∞–ø—Ä–∞—à–∏–≤–∞—é –≤—ã–ø–∏—Å–∫—É...</b>\n"
            "<i>–û–±—ã—á–Ω–æ —ç—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç 10-20 —Å–µ–∫—É–Ω–¥</i>",
            parse_mode="HTML"
        )

        # ‚¨áÔ∏è –í—ã–∑—ã–≤–∞–µ–º –Ω–∞—à—É –≥–ª–∞–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é!
        result = await get_egrul_extract(text)
        await wait_msg.delete()

        if 'error' in result:
            await message.answer(f"‚ùå {result['error']}", reply_markup=main_keyboard)
        else:
            # ‚¨áÔ∏è –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–∞–π–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
            document = FSInputFile(result['filepath'])
            await message.answer_document(
                document,
                caption=(
                    "‚úÖ <b>–í—ã–ø–∏—Å–∫–∞ –ø–æ–ª—É—á–µ–Ω–∞!</b>\n"
                    f"üìÑ {result['org_name'][:200]}...\n"
                    '<i>–ò—Å—Ç–æ—á–Ω–∏–∫: </i><a href="https://egrul.nalog.ru">–§–ù–° –†–æ—Å—Å–∏–∏</a>'
                ),
                parse_mode="HTML",
                reply_markup=main_keyboard
            )
            
            # ‚¨áÔ∏è –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ (—á—Ç–æ–±—ã –Ω–µ –∑–∞—Å–æ—Ä—è—Ç—å –¥–∏—Å–∫)
            try:
                os.remove(result['filepath'])
            except:
                pass

        del user_search_type[user_id]

8. –§–∞–π–ª nalog_parser.py ‚Äî —Ä–∞–±–æ—Ç–∞ —Å —Å–∞–π—Ç–æ–º –§–ù–° (—Å–∞–º–æ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ!)

–≠—Ç–æ—Ç —Ñ–∞–π–ª ‚Äî —Å–µ—Ä–¥—Ü–µ –±–æ—Ç–∞. –ò–º–µ–Ω–Ω–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤—Å—è –º–∞–≥–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—ã–ø–∏—Å–æ–∫ –∏–∑ –ï–ì–†–Æ–õ.
üìö –ß—Ç–æ —Ç–∞–∫–æ–µ –ï–ì–†–Æ–õ?

–ï–ì–†–Æ–õ ‚Äî –ï–¥–∏–Ω—ã–π –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü. –≠—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤—Å–µ—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –≤ –†–æ—Å—Å–∏–∏. –§–ù–° (–Ω–∞–ª–æ–≥–æ–≤–∞—è) –≤–µ–¥—ë—Ç —ç—Ç–æ—Ç —Ä–µ–µ—Å—Ç—Ä –∏ –≤—ã–¥–∞—ë—Ç –≤—ã–ø–∏—Å–∫–∏ ‚Äî –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.
üîç –¢—Ä–∏ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã –ø–∞—Ä—Å–µ—Ä–∞:

    find_inn_by_name ‚Äî –Ω–∞–π—Ç–∏ –ò–ù–ù –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

    find_name_by_inn ‚Äî –Ω–∞–π—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ –ò–ù–ù

    get_egrul_extract ‚Äî –ø–æ–ª—É—á–∏—Ç—å –≤—ã–ø–∏—Å–∫—É (PDF-—Ñ–∞–π–ª) ‚Äî —Å–∞–º–æ–µ —Å–ª–æ–∂–Ω–æ–µ!

üì• –ò–º–ø–æ—Ä—Ç—ã

import aiohttp  # ‚¨ÖÔ∏è –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ (–∫–∞–∫ –±—Ä–∞—É–∑–µ—Ä, —Ç–æ–ª—å–∫–æ –≤ –∫–æ–¥–µ)
from bs4 import BeautifulSoup  # ‚¨ÖÔ∏è –ü–∞—Ä—Å–∏—Ç HTML (–¥–æ—Å—Ç–∞—ë—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
import re  # ‚¨ÖÔ∏è –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è (–ø–æ–∏—Å–∫ –ø–æ —à–∞–±–ª–æ–Ω—É, –Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞–π—Ç–∏ –≤—Å–µ —Ü–∏—Ñ—Ä—ã)
import asyncio  # ‚¨ÖÔ∏è –î–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏ (—á—Ç–æ–±—ã –±–æ—Ç –Ω–µ –∑–∞–≤–∏—Å–∞–ª –≤ –æ–∂–∏–¥–∞–Ω–∏–∏)
import time  # ‚¨ÖÔ∏è –î–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º (—Ç–∞–π–º–µ—Ä—ã, –ø–∞—É–∑—ã)
import os  # ‚¨ÖÔ∏è –î–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏ (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å PDF, —É–¥–∞–ª–∏—Ç—å)

–§—É–Ω–∫—Ü–∏—è find_inn_by_name ‚Äî –ø–æ–∏—Å–∫ –ò–ù–ù –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é

async def find_inn_by_name(company_name: str) -> str:
    """
    –ò—â–µ—Ç –ò–ù–ù –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –Ω–∞ —Å–∞–π—Ç–µ nalog.ru
    ‚¨ÜÔ∏è async ‚Äî —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–Ω–µ
    ‚¨ÜÔ∏è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (—Å—Ç—Ä–æ–∫—É)
    ‚¨ÜÔ∏è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º (–ò–ù–ù –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ)
    """
    
    base_url = "https://egrul.nalog.ru"  # ‚¨ÖÔ∏è –ë–∞–∑–æ–≤—ã–π –∞–¥—Ä–µ—Å —Å–∞–π—Ç–∞ –§–ù–°
    
    # ‚¨áÔ∏è –ó–∞–≥–æ–ª–æ–≤–∫–∏ HTTP-–∑–∞–ø—Ä–æ—Å–∞ (–ø—Ä–∏—Ç–≤–æ—Ä—è–µ–º—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º)
    headers = {
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
        # ‚¨ÜÔ∏è –ì–æ–≤–æ—Ä–∏–º —Å–µ—Ä–≤–µ—Ä—É: "—è –±—Ä–∞—É–∑–µ—Ä Chrome –Ω–∞ Windows"
        'Content-Type': 'application/x-www-form-urlencoded',
        # ‚¨ÜÔ∏è –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º
        'Accept': 'application/json, text/javascript, */*; q=0.01',
        # ‚¨ÜÔ∏è –ì–æ–≤–æ—Ä–∏–º: "–ø–æ–Ω–∏–º–∞—é JSON –∏ –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ"
        'X-Requested-With': 'XMLHttpRequest'
        # ‚¨ÜÔ∏è –ì–æ–≤–æ—Ä–∏–º: "—ç—Ç–æ AJAX-–∑–∞–ø—Ä–æ—Å" (–∫–∞–∫ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–∞–π—Ç)
    }

    try:
        # ‚¨áÔ∏è –°–æ–∑–¥–∞—ë–º —Å–µ—Å—Å–∏—é (–∫–∞–∫ –±—Ä–∞—É–∑–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–Ω–∏—Ç –∫—É–∫–∏)
        async with aiohttp.ClientSession() as session:
            
            # ===== –®–ê–ì 1: –ü–æ–ª—É—á–∞–µ–º –∫—É–∫–∏ =====
            print("üåê –ü–æ–ª—É—á–∞–µ–º –∫—É–∫–∏...")
            async with session.get(f"{base_url}/index.html", headers=headers) as response:
                if response.status != 200:
                    return f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {response.status}"
                print("‚úÖ –ö—É–∫–∏ –ø–æ–ª—É—á–µ–Ω—ã")
                # ‚¨ÜÔ∏è –ö—É–∫–∏ ‚Äî —ç—Ç–æ –∫–∞–∫ "–ø—Ä–æ–ø—É—Å–∫" –Ω–∞ —Å–∞–π—Ç. –ë–µ–∑ –Ω–∏—Ö —Å–∞–π—Ç –Ω–µ –ø—É—Å—Ç–∏—Ç –¥–∞–ª—å—à–µ

            # ===== –®–ê–ì 2: –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å =====
            print(f"üîç –ò—â–µ–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é '{company_name}'...")
            search_data = {
                'query': company_name,  # ‚¨ÖÔ∏è –ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
                'page': '1',            # ‚¨ÖÔ∏è –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                'search-type': 'ul'     # ‚¨ÖÔ∏è –ò—â–µ–º —é—Ä–ª–∏—Ü–∞ (–Ω–µ –ò–ü)
            }

            async with session.post(f"{base_url}/", data=search_data, headers=headers) as response:
                if response.status != 200:
                    return f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞: {response.status}"

                search_result = await response.json()  # ‚¨ÖÔ∏è –û—Ç–≤–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON
                print(f"üì¶ –û—Ç–≤–µ—Ç –Ω–∞ –ø–æ–∏—Å–∫: {search_result}")

                # ‚¨áÔ∏è –ò–∑–≤–ª–µ–∫–∞–µ–º ID –∑–∞–ø—Ä–æ—Å–∞ (–Ω—É–∂–µ–Ω –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)
                request_id = None
                if isinstance(search_result, dict):
                    if 't' in search_result:
                        request_id = search_result['t']  # ‚¨ÖÔ∏è –í–æ—Ç –æ–Ω, ID!
                    elif 'id' in search_result:
                        request_id = search_result['id']

                if not request_id:
                    return "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å ID –∑–∞–ø—Ä–æ—Å–∞"

                print(f"üÜî –ü–æ–ª—É—á–µ–Ω ID –∑–∞–ø—Ä–æ—Å–∞: {request_id[:50]}...")

                # ===== –®–ê–ì 3: –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã =====
                print(f"üì• –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã...")

                max_attempts = 10  # ‚¨ÖÔ∏è –ú–∞–∫—Å–∏–º—É–º 10 –ø–æ–ø—ã—Ç–æ–∫
                attempt = 0
                results = None
                wait_time = 1  # ‚¨ÖÔ∏è –ù–∞—á–∏–Ω–∞–µ–º –∂–¥–∞—Ç—å 1 —Å–µ–∫—É–Ω–¥—É

                while attempt < max_attempts:
                    attempt += 1
                    print(f"‚è≥ –ü–æ–ø—ã—Ç–∫–∞ {attempt}/{max_attempts} (–∂–¥—ë–º {wait_time} —Å–µ–∫)...")

                    # ‚¨áÔ∏è –°–∞–π—Ç –§–ù–° —Ç—Ä–µ–±—É–µ—Ç timestamp (–≤—Ä–µ–º—è –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö)
                    timestamp = int(time.time() * 1000)
                    results_url = f"{base_url}/search-result/{request_id}?r={timestamp}&_={timestamp}"

                    async with session.get(results_url, headers=headers) as resp:
                        if resp.status == 200:
                            data = await resp.json()

                            if 'status' in data and data['status'] == 'wait':
                                print(f"‚è≥ –°–µ—Ä–≤–µ—Ä –≥–æ–≤–æ—Ä–∏—Ç 'wait', –¥–∞–Ω–Ω—ã–µ –µ—â—ë –≥–æ—Ç–æ–≤—è—Ç—Å—è...")
                                await asyncio.sleep(wait_time)  # ‚¨ÖÔ∏è –ñ–¥—ë–º
                                wait_time += 1  # ‚¨ÖÔ∏è –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è
                                continue
                            else:
                                results = data
                                print(f"‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–ª—É—á–µ–Ω—ã –Ω–∞ –ø–æ–ø—ã—Ç–∫–µ {attempt}")
                                break
                        else:
                            error_text = await resp.text()
                            print(f"‚ùå –û—à–∏–±–∫–∞ {resp.status}: {error_text[:200]}")
                            return f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: {resp.status}"

                if not results:
                    return "‚ùå –ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤."

                # ===== –®–ê–ì 4: –ü–∞—Ä—Å–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã =====
                print(f"üì¶ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–ª—É—á–µ–Ω—ã")

                if 'rows' in results and len(results['rows']) > 0:
                    total_results = len(results['rows'])
                    print(f"üìä –í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ: {total_results}")

                    output = f"üìã **–ù–∞–π–¥–µ–Ω–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π: {total_results}**\n\n"

                    # ‚¨áÔ∏è –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–µ –±–æ–ª—å—à–µ 10 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                    max_show = min(10, total_results)
                    output += f"**–ü–µ—Ä–≤—ã–µ {max_show} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:**\n\n"

                    for i, row in enumerate(results['rows'][:max_show], 1):
                        org_info = []

                        # ‚¨áÔ∏è –ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
                        if 'n' in row:
                            name = row['n']
                            if len(name) > 200:
                                name = name[:200] + "..."
                            org_info.append(f"**{i}. {name}**")

                        # ‚¨áÔ∏è –ò–ù–ù
                        if 'i' in row:
                            org_info.append(f"–ò–ù–ù: `{row['i']}`")

                        # ‚¨áÔ∏è –û–ì–†–ù –∏ –¥–∞—Ç–∞
                        if 'o' in row:
                            org_info.append(f"–û–ì–†–ù: {row['o']}")
                        if 'r' in row:
                            org_info.append(f"–î–∞—Ç–∞: {row['r']}")

                        output += "\n".join(org_info) + "\n\n"

                    return output

                return "‚ùå –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"

    except Exception as e:
        print(f"‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: {e}")
        return f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ: {e}"

üß† –ß—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç (–ø—Ä–æ—Å—Ç—ã–µ —Å–ª–æ–≤–∞):

    –ü—Ä–∏—Ç–≤–æ—Ä—è–µ–º—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏, —á—Ç–æ–±—ã —Å–∞–π—Ç –Ω–µ –ø–æ–Ω—è–ª, —á—Ç–æ –º—ã –±–æ—Ç

    –ü–æ–ª—É—á–∞–µ–º –∫—É–∫–∏ ‚Äî –∑–∞—Ö–æ–¥–∏–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å "–ø—Ä–æ–ø—É—Å–∫"

    –ò—â–µ–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ, –ø–æ–ª—É—á–∞–µ–º ID –∑–∞–ø—Ä–æ—Å–∞

    –ñ–¥—ë–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã ‚Äî —Å–∞–π—Ç –§–ù–° –≥–æ—Ç–æ–≤–∏—Ç –¥–∞–Ω–Ω—ã–µ –Ω–µ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ, –Ω—É–∂–Ω–æ –ø–æ–¥–æ–∂–¥–∞—Ç—å

    –ü–∞—Ä—Å–∏–º JSON ‚Äî —Ä–∞–∑–±–∏—Ä–∞–µ–º –æ—Ç–≤–µ—Ç –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

9. –°–∞–º–∞—è –≤–∞–∂–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è ‚Äî get_egrul_extract (–ø–æ–ª—É—á–µ–Ω–∏–µ PDF)

–≠—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä—É—é –º—ã —Ç–∞–∫ –¥–æ–ª–≥–æ –æ—Ç–ª–∞–∂–∏–≤–∞–ª–∏! –û–Ω–∞ –¥–µ–ª–∞–µ—Ç 3 –∑–∞–ø—Ä–æ—Å–∞ –∫ –§–ù–°:

async def get_egrul_extract(inn: str) -> dict:
    """
    –ü–æ–ª—É—á–∞–µ—Ç –≤—ã–ø–∏—Å–∫—É –∏–∑ –ï–ì–†–Æ–õ –ø–æ –ò–ù–ù
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª–æ–≤–∞—Ä—å —Å –ø—É—Ç—ë–º –∫ —Ñ–∞–π–ª—É –∏–ª–∏ –æ—à–∏–±–∫–æ–π
    """
    print(f"üîç get_egrul_extract: –Ω–∞—á–∏–Ω–∞–µ–º –ø–æ–∏—Å–∫ –¥–ª—è –ò–ù–ù {inn}")

    # ‚¨áÔ∏è –†–∞–∑–Ω—ã–µ –∞–¥—Ä–µ—Å–∞ –Ω–∞ —Å–∞–π—Ç–µ –§–ù–°
    base_url = "https://egrul.nalog.ru"
    search_url = f"{base_url}/"                     # –î–ª—è –ø–æ–∏—Å–∫–∞
    result_url = f"{base_url}/search-result/"       # –î–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    request_url = f"{base_url}/vyp-request/"        # –î–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –≤—ã–ø–∏—Å–∫–∏ (–®–ê–ì 5!)
    status_url = f"{base_url}/vyp-status/"          # –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ (–®–ê–ì 6!)
    download_base = f"{base_url}/vyp-download/"     # –î–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è (–®–ê–ì 8!)

    # ‚¨áÔ∏è –ó–∞–≥–æ–ª–æ–≤–∫–∏ (–ø—Ä–∏—Ç–≤–æ—Ä—è–µ–º—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º Safari –Ω–∞ Mac)
    headers = {
        'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/18.3 Safari/605.1.15',
        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
        'Accept-Language': 'ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7',
    }

    try:
        async with aiohttp.ClientSession() as session:
            # ===== –®–ê–ì 1: –ü–æ–ª—É—á–∞–µ–º –∫—É–∫–∏ =====
            print("üåê –ü–æ–ª—É—á–∞–µ–º –∫—É–∫–∏...")
            async with session.get(f"{base_url}/index.html", headers=headers) as response:
                if response.status != 200:
                    return {'error': f'–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: {response.status}'}
                print("‚úÖ –ö—É–∫–∏ –ø–æ–ª—É—á–µ–Ω—ã")

            # ===== –®–ê–ì 2: –ò—â–µ–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é =====
            print(f"üîç –ò—â–µ–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é —Å –ò–ù–ù {inn}...")
            
            # ‚¨áÔ∏è –ó–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è AJAX-–∑–∞–ø—Ä–æ—Å–æ–≤
            ajax_headers = {
                'User-Agent': headers['User-Agent'],
                'Accept': 'application/json, text/javascript, */*; q=0.01',
                'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
                'X-Requested-With': 'XMLHttpRequest',
                'Referer': f"{base_url}/index.html",
            }

            search_data = {
                'query': inn,
                'page': '1',
                'search-type': 'ul'
            }

            async with session.post(search_url, data=search_data, headers=ajax_headers) as response:
                if response.status != 200:
                    return {'error': f'–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞: {response.status}'}

                search_result = await response.json()
                request_id = search_result.get('t')
                if not request_id:
                    return {'error': '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å ID –∑–∞–ø—Ä–æ—Å–∞'}

                print(f"üÜî ID –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—É—á–µ–Ω (–¥–ª–∏–Ω–∞ {len(request_id)})")

            # ===== –®–ê–ì 3: –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ =====
            print(f"üì• –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã...")

            max_attempts = 10
            attempt = 0
            results = None
            wait_time = 2

            while attempt < max_attempts:
                attempt += 1
                print(f"‚è≥ –ü–æ–ø—ã—Ç–∫–∞ {attempt}/{max_attempts} (–∂–¥—ë–º {wait_time} —Å–µ–∫)...")

                timestamp = int(time.time() * 1000)
                results_url = f"{result_url}{request_id}?r={timestamp}&_={timestamp}"

                async with session.get(results_url, headers=ajax_headers) as resp:
                    if resp.status == 200:
                        try:
                            data = await resp.json()
                        except:
                            text = await resp.text()
                            if "–û—à–∏–±–∫–∞" in text:
                                return {'error': '‚ùå –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –Ω–∞ —Å–∞–π—Ç–µ –§–ù–°'}
                            return {'error': '–ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞'}

                        if isinstance(data, dict) and data.get('status') == 'wait':
                            print(f"‚è≥ –°–µ—Ä–≤–µ—Ä –≥–æ–≤–æ—Ä–∏—Ç 'wait'...")
                            await asyncio.sleep(wait_time)
                            wait_time += 1
                            continue
                        else:
                            results = data
                            print(f"‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–ª—É—á–µ–Ω—ã –Ω–∞ –ø–æ–ø—ã—Ç–∫–µ {attempt}")
                            break
                    else:
                        print(f"‚ùå –û—à–∏–±–∫–∞ {resp.status}")
                        await asyncio.sleep(wait_time)
                        wait_time += 1

            if not results:
                return {'error': '–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤'}

            # ===== –®–ê–ì 4: –ü–æ–ª—É—á–∞–µ–º –∫–æ–¥ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è =====
            print("üîç –ü–æ–ª—É—á–∞–µ–º –∫–æ–¥ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è...")

            t_value = None
            org_name = "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è"

            if isinstance(results, dict) and 'rows' in results and len(results['rows']) > 0:
                first_row = results['rows'][0]
                org_name = first_row.get('n', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è')

                if 't' in first_row:
                    t_value = first_row['t']
                    print(f"‚úÖ –ù–∞–π–¥–µ–Ω –∫–æ–¥ –≤ –ø–æ–ª–µ 't': –¥–ª–∏–Ω–∞ {len(t_value)}")

                    if len(t_value) < 150:
                        print(f"‚ö†Ô∏è –ö–æ—Ä–æ—Ç–∫–∏–π –∫–æ–¥ ({len(t_value)}) - –≤—ã–ø–∏—Å–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ –µ—â—ë –Ω–µ –≥–æ—Ç–æ–≤–∞")

            if not t_value:
                return {'error': '–ù–µ –Ω–∞–π–¥–µ–Ω –∫–æ–¥ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è'}

            # ===== –®–ê–ì 5: –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–ø–∏—Å–∫—É —á–µ—Ä–µ–∑ vyp-request (–°–ê–ú–û–ï –í–ê–ñ–ù–û–ï!) =====
            print("üîÑ –®–ê–ì 5: –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–ø–∏—Å–∫—É —á–µ—Ä–µ–∑ vyp-request...")
            request_activate_url = f"{request_url}{t_value}?r=&_={int(time.time()*1000)}"

            async with session.get(request_activate_url, headers=ajax_headers) as resp:
                if resp.status == 200:
                    print("‚úÖ –ó–∞–ø—Ä–æ—Å –Ω–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏—é –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ")
                    try:
                        activate_data = await resp.json()
                        print(f"üìä –û—Ç–≤–µ—Ç –Ω–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏—é: {activate_data}")
                        # ‚¨ÜÔ∏è –ó–¥–µ—Å—å –ø—Ä–∏—Ö–æ–¥–∏—Ç –î–õ–ò–ù–ù–´–ô –∫–æ–¥ (160 —Å–∏–º–≤–æ–ª–æ–≤)!
                    except:
                        print("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –æ—Ç–≤–µ—Ç –∞–∫—Ç–∏–≤–∞—Ü–∏–∏")
                else:
                    print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏: {resp.status}")

            # ===== –®–ê–ì 6: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ vyp-status =====
            print("‚è≥ –®–ê–ì 6: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –≤—ã–ø–∏—Å–∫–∏...")

            max_status_attempts = 15
            status_attempt = 0
            status_wait_time = 2
            ready = False

            while status_attempt < max_status_attempts and not ready:
                status_attempt += 1
                print(f"‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ {status_attempt}/{max_status_attempts} (–∂–¥—ë–º {status_wait_time} —Å–µ–∫)...")

                timestamp = int(time.time() * 1000)
                check_status_url = f"{status_url}{t_value}?r={timestamp}&_={timestamp}"

                async with session.get(check_status_url, headers=ajax_headers) as resp:
                    if resp.status == 200:
                        try:
                            status_data = await resp.json()
                            print(f"üìä –°—Ç–∞—Ç—É—Å: {status_data}")

                            if status_data.get('status') == 'ready':
                                print("‚úÖ –í—ã–ø–∏—Å–∫–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Å–∫–∞—á–∏–≤–∞–Ω–∏—é!")
                                ready = True
                                break
                            elif status_data.get('status') == 'wait':
                                print(f"‚è≥ –í—ã–ø–∏—Å–∫–∞ –µ—â—ë –≥–æ—Ç–æ–≤–∏—Ç—Å—è...")
                                await asyncio.sleep(status_wait_time)
                                status_wait_time += 1
                                continue
                            else:
                                await asyncio.sleep(status_wait_time)
                                status_wait_time += 1
                                continue
                        except Exception as e:
                            print(f"‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å—Ç–∞—Ç—É—Å–∞: {e}")
                            await asyncio.sleep(status_wait_time)
                            status_wait_time += 1
                            continue
                    else:
                        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞: {resp.status}")
                        await asyncio.sleep(status_wait_time)
                        status_wait_time += 1

            if not ready:
                return {'error': '–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –≤—ã–ø–∏—Å–∫–∏'}

            # ===== –®–ê–ì 7: –ñ–¥—ë–º –Ω–µ–º–Ω–æ–≥–æ –ø–µ—Ä–µ–¥ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ–º =====
            print("‚è≥ –ñ–¥—ë–º 2 —Å–µ–∫—É–Ω–¥—ã –ø–µ—Ä–µ–¥ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ–º...")
            await asyncio.sleep(2)

            # ===== –®–ê–ì 8: –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª =====
            download_link = f"{download_base}{t_value}"
            print(f"üì• –®–ê–ì 8: –°–∫–∞—á–∏–≤–∞—é —Ñ–∞–π–ª: {download_link[:100]}...")

            # ‚¨áÔ∏è –ó–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è PDF
            download_headers = {
                'User-Agent': headers['User-Agent'],
                'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
                'Accept-Language': 'ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7',
                'Referer': f"{base_url}/index.html",
                'Connection': 'keep-alive',
            }

            # ‚¨áÔ∏è –î–æ–±–∞–≤–ª—è–µ–º –∫—É–∫–∏ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∏
            all_cookies = session.cookie_jar.filter_cookies(f"{base_url}/index.html")
            cookie_parts = []
            for key, cookie in all_cookies.items():
                cookie_parts.append(f"{key}={cookie.value}")
            if cookie_parts:
                download_headers['Cookie'] = '; '.join(cookie_parts)
                print(f"üç™ –ü–µ—Ä–µ–¥–∞—ë–º –∫—É–∫–∏: {len(cookie_parts)} —à—Ç.")

            async with session.get(download_link, headers=download_headers, allow_redirects=True) as file_response:
                print(f"üìã –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: {file_response.status}")

                if file_response.status == 200:
                    content = await file_response.read()
                    print(f"üìä –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: {len(content)} –±–∞–π—Ç")

                    # ‚¨áÔ∏è –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ PDF
                    if len(content) > 1000 and content[:4].startswith(b'%PDF'):
                        print("‚úÖ –ü–æ–ª—É—á–µ–Ω –≤–∞–ª–∏–¥–Ω—ã–π PDF")

                        # ‚¨áÔ∏è –ü–æ–ª—É—á–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞ –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
                        content_disp = file_response.headers.get('content-disposition', '')
                        filename = "extract.pdf"
                        if 'filename=' in content_disp:
                            match = re.search(r'filename=([^;]+)', content_disp)
                            if match:
                                filename = match.group(1).strip('"')

                        # ‚¨áÔ∏è –°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É data, –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
                        if not os.path.exists('data'):
                            os.makedirs('data')
                            print("üìÅ –°–æ–∑–¥–∞–Ω–∞ –ø–∞–ø–∫–∞ data")

                        filepath = f"data/{filename}"
                        with open(filepath, 'wb') as f:
                            f.write(content)

                        print(f"‚úÖ –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—ë–Ω: {filepath}")
                        return {
                            'success': True,
                            'filename': filename,
                            'filepath': filepath,
                            'org_name': org_name
                        }
                    else:
                        print(f"‚ùå –§–∞–π–ª –Ω–µ —è–≤–ª—è–µ—Ç—Å—è PDF –∏–ª–∏ —Å–ª–∏—à–∫–æ–º –º–∞–ª")
                        return {'error': '–ü–æ–ª—É—á–µ–Ω –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã–π —Ñ–∞–π–ª'}
                else:
                    print(f"‚ùå –û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è: {file_response.status}")
                    return {'error': f'–û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è: {file_response.status}'}

    except Exception as e:
        print(f"‚ùå –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: {e}")
        import traceback
        traceback.print_exc()
        return {'error': f'–û—à–∏–±–∫–∞: {str(e)}'}

üéØ –ü–æ—á–µ–º—É —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Ç–∞–∫–∞—è —Å–ª–æ–∂–Ω–∞—è?

    –°–∞–π—Ç –§–ù–° –∑–∞—â–∏—â–∞–µ—Ç—Å—è –æ—Ç –±–æ—Ç–æ–≤ ‚Äî –Ω—É–∂–Ω–æ —Ç–æ—á–Ω–æ –ø–æ–≤—Ç–æ—Ä—è—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞

    –¢—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞ –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ:

        –ü–µ—Ä–≤—ã–π (vyp-request) ‚Äî –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –≤—ã–ø–∏—Å–∫—É

        –í—Ç–æ—Ä–æ–π (vyp-status) ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å

        –¢—Ä–µ—Ç–∏–π (vyp-download) ‚Äî —Å–∫–∞—á–∏–≤–∞–µ—Ç PDF

    –ö—É–∫–∏ ‚Äî –±–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∫—É–∫ —Å–∞–π—Ç –Ω–µ –æ—Ç–¥–∞—Å—Ç —Ñ–∞–π–ª

    –¢–∞–π–º–∏–Ω–≥–∏ ‚Äî –Ω—É–∂–Ω–æ –∂–¥–∞—Ç—å, –ø–æ–∫–∞ –≤—ã–ø–∏—Å–∫–∞ —Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è

10. –§–∞–π–ª gigachat.py ‚Äî —Ä–∞–±–æ—Ç–∞ —Å GigaChat

–ó–¥–µ—Å—å –≤—Å—ë –ø—Ä–æ—â–µ ‚Äî –º—ã –ø—Ä–æ—Å—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å—ã –≤ GigaChat –∏ –ø–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç—ã.
–ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π (—Ç–æ, —á—Ç–æ –º—ã –¥–æ–±–∞–≤–∏–ª–∏!)

class GigaChatInnAssistant:
    """–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –ò–ù–ù –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º"""

    def __init__(self):
        # ‚¨áÔ∏è –•—Ä–∞–Ω–∏–ª–∏—â–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ –∫–∞–∂–¥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        # –≠—Ç–æ —Å–ª–æ–≤–∞—Ä—å, –≥–¥–µ –∫–ª—é—á ‚Äî ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∞ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
        self.user_history = {}  # {user_id: [{"user": –≤–æ–ø—Ä–æ—Å, "bot": –æ—Ç–≤–µ—Ç}, ...]}
        self.max_history = 20    # –°–∫–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞–ø–æ–º–∏–Ω–∞—Ç—å
        
        # ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ ...

–ú–µ—Ç–æ–¥ ask_question —Å –∏—Å—Ç–æ—Ä–∏–µ–π

async def ask_question(self, user_id: int, question: str) -> str:
    """–û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –æ–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã —Å —É—á—ë—Ç–æ–º –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞"""
    
    if not self.available:
        return "‚ùå GigaChat –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"

    # ‚¨áÔ∏è –ü–æ–ª—É—á–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å–ª–∏ –µ—ë –Ω–µ—Ç, —Å–æ–∑–¥–∞—ë–º –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫)
    if user_id not in self.user_history:
        self.user_history[user_id] = []

    # ‚¨áÔ∏è –ë–µ—Ä—ë–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
    recent_history = self.user_history[user_id][-self.max_history:]

    # ‚¨áÔ∏è –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
    history_text = ""
    if recent_history:
        history_text = "–í–æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ —ç—Ç–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞. –£—á–∏—Ç—ã–≤–∞–π –∏—Ö –ø—Ä–∏ –æ—Ç–≤–µ—Ç–µ:\n\n"
        for msg in recent_history:
            history_text += f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {msg['user']}\n"
            history_text += f"–¢—ã: {msg['bot']}\n"
        history_text += "\n---\n"

    # ‚¨áÔ∏è –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç (–∑–∞–ø—Ä–æ—Å –∫ GigaChat)
    prompt = f"""{history_text}–¢–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {question}

–í–ê–ñ–ù–û: –û—Ç–≤–µ—á–∞–π, —É—á–∏—Ç—ã–≤–∞—è –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è. –ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –Ω–µ–ø–æ–ª–Ω—ã–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, '–Ω–∞—Å–µ–ª–µ–Ω–∏–µ'), –æ—Ç–≤–µ—á–∞–π –ø—Ä–æ —Ç–æ, –æ —á—ë–º —à–ª–∞ —Ä–µ—á—å —Ä–∞–Ω–µ–µ.

–û—Ç–≤–µ—Ç –Ω–∞–ø–∏—à–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ."""

    try:
        # ‚¨áÔ∏è –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –≤ GigaChat
        response = self.client.chat(prompt)
        answer = response.choices[0].message.content.strip()

        # ‚¨áÔ∏è –°–æ—Ö—Ä–∞–Ω—è–µ–º —ç—Ç–æ—Ç –¥–∏–∞–ª–æ–≥ –≤ –∏—Å—Ç–æ—Ä–∏—é
        self.user_history[user_id].append({
            "user": question,
            "bot": answer
        })

        # ‚¨áÔ∏è –û–±—Ä–µ–∑–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é, –µ—Å–ª–∏ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–∞—è
        if len(self.user_history[user_id]) > self.max_history * 2:
            self.user_history[user_id] = self.user_history[user_id][-self.max_history:]

        return f"üí¨ **–û—Ç–≤–µ—Ç:**\n\n{answer}"
    except Exception as e:
        return f"‚ùå –û—à–∏–±–∫–∞: {e}"

11. Git ‚Äî –∫–∞–∫ –º—ã —Å–æ—Ö—Ä–∞–Ω—è–ª–∏ –∫–æ–¥
–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (—Å –ø–æ—è—Å–Ω–µ–Ω–∏—è–º–∏)

# –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã)
git status

# –î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª—ã –≤ –∫–æ–º–º–∏—Ç (–ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—é)
git add bot/parsers/nalog_parser.py

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è (–∫–æ–º–º–∏—Ç) —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º
git commit -m "Fix EGRUL extraction with full cycle"

# –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ GitHub
git push origin main

# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –≤–µ—Ç–∫—É
git checkout -b feature/fix-egrul-activation

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –≤–µ—Ç–∫–∏
git branch

# –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –¥—Ä—É–≥—É—é –≤–µ—Ç–∫—É
git checkout main

# –°–ª–∏—Ç—å –≤–µ—Ç–∫—É –≤ —Ç–µ–∫—É—â—É—é
git merge feature/fix-egrul-activation

# –£–¥–∞–ª–∏—Ç—å –≤–µ—Ç–∫—É (–ø–æ—Å–ª–µ —Å–ª–∏—è–Ω–∏—è)
git branch -d feature/fix-egrul-activation
git push origin --delete feature/fix-egrul-activation

üåø –ó–∞—á–µ–º –Ω—É–∂–Ω—ã –≤–µ—Ç–∫–∏?

–í–µ—Ç–∫–∏ ‚Äî —ç—Ç–æ –∫–∞–∫ —á–µ—Ä–Ω–æ–≤–∏–∫–∏:

    –í main –ª–µ–∂–∏—Ç —á–∏—Å—Ç–æ–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç (–¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

    –í feature/... –ª–µ–∂–∞—Ç —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã

    –ö–æ–≥–¥–∞ –≤—Å—ë –≥–æ—Ç–æ–≤–æ ‚Äî —Å–ª–∏–≤–∞–µ–º —á–µ—Ä–Ω–æ–≤–∏–∫ –≤ —á–∏—Å—Ç–æ–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç

12. Railway ‚Äî –∫–∞–∫ –±–æ—Ç –ø–æ–ø–∞–ª –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
–ß—Ç–æ —Ç–∞–∫–æ–µ –¥–µ–ø–ª–æ–π?

–î–µ–ø–ª–æ–π ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ —Ç–≤–æ–π –±–æ—Ç –ø–µ—Ä–µ–µ–∑–∂–∞–µ—Ç —Å —Ç–≤–æ–µ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å 24/7.
–í–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è Railway

# Procfile ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è, –∫–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å
web: python -m bot.__main__

# runtime.txt ‚Äî –≤–µ—Ä—Å–∏—è Python
python-3.12.0

# requirements.txt ‚Äî –≤—Å–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
aiogram==3.17.0
aiohttp==3.11.11
beautifulsoup4==4.12.3
lxml==5.3.0
python-dotenv==1.0.1
gigachat==0.1.13

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Å–µ–∫—Ä–µ—Ç—ã)

–í Railway –µ—Å—Ç—å —Ä–∞–∑–¥–µ–ª Variables, –∫—É–¥–∞ –º—ã –¥–æ–±–∞–≤–∏–ª–∏:
KEY	VALUE
BOT_TOKEN	—Ç–≤–æ–π_—Ç–æ–∫–µ–Ω
BOT_ADMIN_ID	—Ç–≤–æ–π_id
BOT_GIGACHAT_API_KEY	—Ç–≤–æ–π_–∫–ª—é—á

–í–∞–∂–Ω–æ! –≠—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–µ –≤–∏–¥–Ω—ã –Ω–∏–∫–æ–º—É, –∫—Ä–æ–º–µ Railway –∏ —Ç–≤–æ–µ–≥–æ –±–æ—Ç–∞.
13. –°–ª–æ–≤–∞—Ä—å —Ç–µ—Ä–º–∏–Ω–æ–≤ –¥–ª—è –Ω–æ–≤–∏—á–∫–∞
–¢–µ—Ä–º–∏–Ω	–ß—Ç–æ –∑–Ω–∞—á–∏—Ç –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å	–ë–æ—Ç –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–µ–ª –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. –ü–æ–∫–∞ –∂–¥—ë—Ç –æ—Ç–≤–µ—Ç –æ—Ç –§–ù–°, —É–∂–µ –æ—Ç–≤–µ—á–∞–µ—Ç –¥—Ä—É–≥–∏–º
API	–°–ø–æ—Å–æ–± –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º –æ–±—â–∞—Ç—å—Å—è –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º. –ö–∞–∫ –æ—Ñ–∏—Ü–∏–∞–Ω—Ç –º–µ–∂–¥—É –∫—É—Ö–Ω–µ–π –∏ –∫–ª–∏–µ–Ω—Ç–æ–º
JSON	–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö, –ø–æ–Ω—è—Ç–Ω—ã–π –≤—Å–µ–º —è–∑—ã–∫–∞–º. –ö–∞–∫ —Ç–∞–±–ª–∏—Ü–∞ Excel, —Ç–æ–ª—å–∫–æ –≤ —Ç–µ–∫—Å—Ç–µ
–ö—É–∫–∏ (cookies)	"–ü—Ä–æ–ø—É—Å–∫" –¥–ª—è —Å–∞–π—Ç–∞. –ß—Ç–æ–±—ã —Å–∞–π—Ç –Ω–µ —Å–ø—Ä–∞—à–∏–≤–∞–ª –∫–∞–∂–¥—ã–π —Ä–∞–∑ "—Ç—ã –∫—Ç–æ?"
–°–µ—Å—Å–∏—è	–í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏. –ö–∞–∫ —Ä–∞–∑–≥–æ–≤–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è
–ü–∞—Ä—Å–∏–Ω–≥	–†–∞–∑–±–æ—Ä —Å–∞–π—Ç–∞, —á—Ç–æ–±—ã –¥–æ—Å—Ç–∞—Ç—å –Ω—É–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
–•–µ–¥–µ—Ä—ã (headers)	–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ –∑–∞–ø—Ä–æ—Å–µ (–∫—Ç–æ —Ç—ã, –∫–∞–∫–æ–π –±—Ä–∞—É–∑–µ—Ä, –∫–∞–∫–æ–π —è–∑—ã–∫)
User-Agent	–°—Ç—Ä–æ–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –≥–æ–≤–æ—Ä–∏—Ç —Å–∞–π—Ç—É: "—è –±—Ä–∞—É–∑–µ—Ä Chrome, –Ω–µ –±–æ–π—Å—è –º–µ–Ω—è"
Git	–°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π. –ö–∞–∫ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫..." –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–≤
–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π	–•—Ä–∞–Ω–∏–ª–∏—â–µ –∫–æ–¥–∞ (–ø–∞–ø–∫–∞ —Å –∏—Å—Ç–æ—Ä–∏–µ–π –∏–∑–º–µ–Ω–µ–Ω–∏–π)
–í–µ—Ç–∫–∞ (branch)	–û—Ç–¥–µ–ª—å–Ω–∞—è –ª–∏–Ω–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –ö–∞–∫ —á–µ—Ä–Ω–æ–≤–∏–∫
–ö–æ–º–º–∏—Ç (commit)	–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º
–ü—É—à (push)	–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞ –Ω–∞ GitHub
–ü—É–ª–ª (pull)	–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–¥–∞ —Å GitHub
–î–µ–ø–ª–æ–π (deploy)	–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ
–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è	–°–µ–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∫–æ–¥–µ
–¢–æ–∫–µ–Ω	–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –±–æ—Ç—É –∏–ª–∏ API
üéâ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–¢–≤–æ–π –±–æ—Ç —Ç–µ–ø–µ—Ä—å —É–º–µ–µ—Ç:

‚úÖ –ù–∞—Ö–æ–¥–∏—Ç—å –ò–ù–ù –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
‚úÖ –ü–æ–ª—É—á–∞—Ç—å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –≤—ã–ø–∏—Å–∫–∏ –∏–∑ –ï–ì–†–Æ–õ (PDF)
‚úÖ –û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ GigaChat (—Å –∏—Å—Ç–æ—Ä–∏–µ–π 20 —Å–æ–æ–±—â–µ–Ω–∏–π)
‚úÖ –°–æ—Å—Ç–∞–≤–ª—è—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã
‚úÖ –†–∞–±–æ—Ç–∞—Ç—å 24/7 –Ω–∞ Railway
‚úÖ –•—Ä–∞–Ω–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ ‚Äî –∫—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–æ—Ç–∞
üîç –ó–∞—á–µ–º –Ω—É–∂–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞?

–ö–æ–≥–¥–∞ –±–æ—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, —Ö–æ—á–µ—Ç—Å—è –∑–Ω–∞—Ç—å:

    –°–∫–æ–ª—å–∫–æ —á–µ–ª–æ–≤–µ–∫ –∏–º –ø–æ–ª—å–∑—É–µ—Ç—Å—è?

    –ö–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ?

    –ö—Ç–æ –∑–∞—Ö–æ–¥–∏–ª —Å–µ–≥–æ–¥–Ω—è?

–î–ª—è —ç—Ç–æ–≥–æ –º—ã –¥–æ–±–∞–≤–∏–ª–∏ —Å–∏—Å—Ç–µ–º—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.
üìÅ –§–∞–π–ª statistics.py ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

# bot/services/statistics.py
import json  # ‚¨ÖÔ∏è –î–ª—è —Ä–∞–±–æ—Ç—ã —Å JSON-—Ñ–∞–π–ª–∞–º–∏
import os    # ‚¨ÖÔ∏è –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
from datetime import datetime  # ‚¨ÖÔ∏è –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞—Ç–∞–º–∏
from collections import defaultdict  # ‚¨ÖÔ∏è –£–¥–æ–±–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å —Å–æ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

STATS_FILE = "data/statistics.json"  # ‚¨ÖÔ∏è –ì–¥–µ —Ö—Ä–∞–Ω–∏–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

class Statistics:
    def __init__(self):
        # ‚¨ÖÔ∏è –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–±—ä–µ–∫—Ç–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        self.stats = self.load_stats()
    
    def load_stats(self):
        """–ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–∑ —Ñ–∞–π–ª–∞"""
        if os.path.exists(STATS_FILE):
            try:
                with open(STATS_FILE, 'r', encoding='utf-8') as f:
                    return json.load(f)
            except:
                return self.create_empty_stats()
        return self.create_empty_stats()
    
    def create_empty_stats(self):
        """–°–æ–∑–¥–∞—ë—Ç –ø—É—Å—Ç—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏"""
        return {
            "users": {},  # ‚¨ÖÔ∏è –ó–¥–µ—Å—å —Ö—Ä–∞–Ω—è—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö
            "commands": {},  # ‚¨ÖÔ∏è –°—á—ë—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
            "daily": {},  # ‚¨ÖÔ∏è –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–Ω—è–º
            "total_users": 0,  # ‚¨ÖÔ∏è –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            "total_commands": 0  # ‚¨ÖÔ∏è –í—Å–µ–≥–æ –∫–æ–º–∞–Ω–¥
        }
    
    def log_user(self, user_id: int, username: str = None, first_name: str = None):
        """–õ–æ–≥–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç, —á—Ç–æ –æ–Ω –∑–∞—Ö–æ–¥–∏–ª)"""
        today = datetime.now().strftime("%Y-%m-%d")  # ‚¨ÖÔ∏è –°–µ–≥–æ–¥–Ω—è—à–Ω—è—è –¥–∞—Ç–∞
        user_id_str = str(user_id)
        
        if user_id_str not in self.stats["users"]:
            # ‚¨áÔ∏è –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            self.stats["users"][user_id_str] = {
                "first_seen": today,  # ‚¨ÖÔ∏è –ö–æ–≥–¥–∞ –ø–µ—Ä–≤—ã–π —Ä–∞–∑ –∑–∞—à—ë–ª
                "last_seen": today,   # ‚¨ÖÔ∏è –ö–æ–≥–¥–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –∑–∞—Ö–æ–¥–∏–ª
                "username": username,  # ‚¨ÖÔ∏è @username –≤ Telegram
                "first_name": first_name  # ‚¨ÖÔ∏è –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            }
            self.stats["total_users"] += 1
        else:
            # ‚¨áÔ∏è –°—Ç–∞—Ä—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Äî –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞—Ç—É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–∏–∑–∏—Ç–∞
            self.stats["users"][user_id_str]["last_seen"] = today
            if username:
                self.stats["users"][user_id_str]["username"] = username
            if first_name:
                self.stats["users"][user_id_str]["first_name"] = first_name
        
        self.save_stats()  # ‚¨ÖÔ∏è –°—Ä–∞–∑—É —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ñ–∞–π–ª
    
    def log_command(self, user_id: int, command: str):
        """–õ–æ–≥–∏—Ä—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã"""
        today = datetime.now().strftime("%Y-%m-%d")
        
        # ‚¨áÔ∏è –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã
        if command in self.stats["commands"]:
            self.stats["commands"][command] += 1
        else:
            self.stats["commands"][command] = 1
        
        # ‚¨áÔ∏è –õ–æ–≥–∏—Ä—É–µ–º –ø–æ –¥–Ω—è–º
        if today not in self.stats["daily"]:
            self.stats["daily"][today] = {}
        
        if command in self.stats["daily"][today]:
            self.stats["daily"][today][command] += 1
        else:
            self.stats["daily"][today][command] = 1
        
        self.stats["total_commands"] += 1
        self.save_stats()
    
    def get_stats_text(self) -> str:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫—Ä–∞—Å–∏–≤—ã–π —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è –∫–æ–º–∞–Ω–¥—ã /stats"""
        text = "üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞**\n\n"
        text += f"üë• **–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:** {self.stats['total_users']}\n"
        text += f"üìù **–í—Å–µ–≥–æ –∫–æ–º–∞–Ω–¥:** {self.stats['total_commands']}\n\n"
        
        text += "**–ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**\n"
        # ‚¨áÔ∏è –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ last_seen (–ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–≤–µ—Ä—Ö—É)
        sorted_users = sorted(
            self.stats["users"].items(), 
            key=lambda x: x[1]["last_seen"], 
            reverse=True
        )[:10]
        
        for user_id, data in sorted_users:
            name = data.get("first_name") or data.get("username") or "–ë–µ–∑ –∏–º–µ–Ω–∏"
            text += f"‚Ä¢ {name} (ID: {user_id}) ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑: {data['last_seen']}\n"
        
        text += "\n**–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**\n"
        sorted_commands = sorted(
            self.stats["commands"].items(), 
            key=lambda x: x[1], 
            reverse=True
        )[:5]
        
        for cmd, count in sorted_commands:
            # ‚¨áÔ∏è –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∏–º–µ–Ω–∞ –∫–æ–º–∞–Ω–¥ –≤ —á–∏—Ç–∞–µ–º—ã–π –≤–∏–¥
            cmd_names = {
                "ask": "üí¨ –í–æ–ø—Ä–æ—Å—ã",
                "doc": "‚úçÔ∏è –î–æ–∫—É–º–µ–Ω—Ç—ã", 
                "extract": "üìÑ –í—ã–ø–∏—Å–∫–∏",
                "inn_search_start": "üîç –ü–æ–∏—Å–∫ –ò–ù–ù (–Ω–∞—á–∞–ª–æ)",
                "inn_search_complete": "üîç –ü–æ–∏—Å–∫ –ò–ù–ù (–∑–∞–≤–µ—Ä—à—ë–Ω)",
                "help": "‚ùì –ü–æ–º–æ—â—å"
            }
            cmd_display = cmd_names.get(cmd, cmd)
            text += f"‚Ä¢ {cmd_display}: {count} —Ä–∞–∑\n"
        
        return text

# ‚¨áÔ∏è –°–æ–∑–¥–∞—ë–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
# –û–Ω –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤–æ –≤—Å—ë–º –±–æ—Ç–µ
stats = Statistics()

üìä –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:

    log_user ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á—Ç–æ-—Ç–æ –ø–∏—à–µ—Ç –±–æ—Ç—É. –ó–∞–ø–æ–º–∏–Ω–∞–µ—Ç:

        –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–≤—ã–π —Ä–∞–∑ –∑–∞—à—ë–ª

        –ö–æ–≥–¥–∞ –∑–∞—Ö–æ–¥–∏–ª –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑

        –ï–≥–æ –∏–º—è –∏ username

    log_command ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –¥–µ–π—Å—Ç–≤–∏–∏ (–Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏). –°—á–∏—Ç–∞–µ—Ç:

        –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –∫–∞–∂–¥—É—é –∫–æ–º–∞–Ω–¥—É

        –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –¥–Ω—è–º

    get_stats_text ‚Äî —Å–æ–±–∏—Ä–∞–µ—Ç –∫—Ä–∞—Å–∏–≤—ã–π –æ—Ç—á—ë—Ç –¥–ª—è –∞–¥–º–∏–Ω–∞

üëë –ö–æ–º–∞–Ω–¥–∞ /stats (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞)

–í —Ñ–∞–π–ª–µ admin.py –º—ã —Å–æ–∑–¥–∞–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –∫–æ–º–∞–Ω–¥—É:

# bot/handlers/admin.py
from aiogram.types import Message
from aiogram.filters import Command
from bot.config_reader import get_config
from bot.services.statistics import stats

async def cmd_stats(message: Message):
    """–ö–æ–º–∞–Ω–¥–∞ /stats - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞)"""
    config = get_config()
    
    # ‚¨áÔ∏è –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –∞–¥–º–∏–Ω (—Å–≤–µ—Ä—è–µ–º —Å admin_id –∏–∑ .env)
    if message.from_user.id != config.admin_id:
        await message.answer("‚ùå –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞")
        return
    
    stats_text = stats.get_stats_text()
    await message.answer(stats_text, parse_mode="Markdown")

üß† –ü–æ—á–µ–º—É —ç—Ç–æ –ø–æ–ª–µ–∑–Ω–æ?

    –ü–æ–Ω–∏–º–∞–µ—à—å –∞—É–¥–∏—Ç–æ—Ä–∏—é ‚Äî —Å–∫–æ–ª—å–∫–æ –ª—é–¥–µ–π —Ä–µ–∞–ª—å–Ω–æ –ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–æ—Ç–æ–º

    –í–∏–¥–∏—à—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ‚Äî —á—Ç–æ –Ω—É–∂–Ω–æ —É–ª—É—á—à–∞—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å

    –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—à—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Äî –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞—Ö–æ–¥—è—Ç

    –ú–æ–∂–µ—à—å –ø–æ–∫–∞–∑–∞—Ç—å –∏–Ω–≤–µ—Å—Ç–æ—Ä–∞–º (–µ—Å–ª–∏ –≤–¥—Ä—É–≥) ‚Äî "—É –º–æ–µ–≥–æ –±–æ—Ç–∞ 1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π!"